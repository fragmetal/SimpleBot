<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SSH Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.css" />
    <style>
        /* Reset all margins/paddings and force full viewport coverage */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden; /* Prevent scrollbars on the body */
        }
        #terminal {
            height: 100%;
            width: 100%;
            display: block; /* Ensure it's a block element */
        }
    </style>
</head>
<body>
    <div id="terminal"></div>

    <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.11.0/lib/addon-fit.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <script>
        (function() {
            // Create terminal with FitAddon
            const term = new Terminal({ cursorBlink: true, theme: { background: '#000' } });
            const fitAddon = new FitAddon.FitAddon();
            term.loadAddon(fitAddon);
            term.open(document.getElementById('terminal'));

            // Function to resize and optionally log dimensions
            function resizeTerminal() {
                fitAddon.fit();
                console.log(`Terminal resized to ${term.cols}x${term.rows}`);
            }

            // Resize on window resize
            window.addEventListener('resize', resizeTerminal);

            // Resize after a short delay to ensure DOM is ready
            setTimeout(resizeTerminal, 100);

            // Also resize when the element becomes visible (e.g., after tab switch)
            const observer = new ResizeObserver(resizeTerminal);
            observer.observe(document.getElementById('terminal'));

            // WebSocket connection
            const socket = io({
                path: '/ssh-socket',
                transports: ['websocket']
            });

            socket.on('connect', () => {
                term.write('\r\n*** Connected to SSH server ***\r\n');
            });

            socket.on('data', (data) => {
                term.write(data);
            });

            socket.on('disconnect', () => {
                term.write('\r\n*** Disconnected ***\r\n');
            });

            term.onData((data) => {
                socket.emit('data', data);
            });
        })();
    </script>
</body>
</html>
